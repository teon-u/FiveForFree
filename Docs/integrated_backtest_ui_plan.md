# 통합 백테스트 UI 기획안

## 1. 개요

### 배경
- 현재 UI: 각 종목(ticker)별 개별 백테스트만 가능
- 문제점: 포트폴리오 관점의 통합 분석 불가

### 목표
- 다수 종목 동시 백테스트 지원
- 다양한 투자 옵션 비교 분석
- 투자자 관점의 의사결정 지원

---

## 2. 화면 구성

### 2.1 메인 레이아웃
```
┌────────────────────────────────────────────────────────┐
│  [통합 백테스트]                              [실행]   │
├─────────────────────┬──────────────────────────────────┤
│                     │                                  │
│   종목 선택 패널    │        결과 시각화 영역          │
│   (좌측 사이드바)   │        (메인 콘텐츠)             │
│                     │                                  │
├─────────────────────┴──────────────────────────────────┤
│                  옵션 설정 패널                        │
└────────────────────────────────────────────────────────┘
```

### 2.2 종목 선택 패널 (좌측)
- 체크박스로 다중 종목 선택
- "전체 선택" / "전체 해제" 버튼
- 종목별 현재 모델 정확도 표시
- 검색/필터 기능

### 2.3 옵션 설정 패널 (하단)

#### 기본 옵션
| 옵션명 | 설명 | 기본값 |
|--------|------|--------|
| 테스트 기간 | 백테스트 날짜 범위 | 최근 30일 |
| 초기 자본 | 시작 투자금 | $100,000 |
| 진입 확률 기준 | 최소 예측 확률 | 60% |

#### 손절/익절 옵션 (토글)
| 옵션명 | 설명 | 기본값 |
|--------|------|--------|
| 손절 적용 | Stop-Loss 활성화 | ON |
| 손절률 | Stop-Loss 비율 | -2% |
| 익절 적용 | Take-Profit 활성화 | ON |
| 익절률 | Take-Profit 비율 | +1% |
| 최대 보유 시간 | 강제 청산 시간 | 1시간 |

#### 포지션 관리 옵션
| 옵션명 | 설명 | 기본값 |
|--------|------|--------|
| 포지션 사이징 | 고정금액/Kelly/ATR | 고정금액 |
| 최대 드로다운 | 손실 한도 (청산) | 20% |
| 동시 포지션 제한 | 최대 동시 투자 종목 | 5개 |

#### 시간 필터 옵션
| 옵션명 | 설명 | 기본값 |
|--------|------|--------|
| 장중만 거래 | 9:30-16:00 ET만 | ON |
| 장 시작 제외 | 9:30-10:00 제외 | OFF |
| 장 마감 제외 | 15:30-16:00 제외 | OFF |

---

## 3. 결과 시각화

### 3.1 요약 카드 (상단)
```
┌──────────────┬──────────────┬──────────────┬──────────────┐
│  총 수익률   │   총 수익   │   승률      │   MDD        │
│   +15.3%     │  $15,300    │   58.2%     │   -8.5%      │
└──────────────┴──────────────┴──────────────┴──────────────┘
```

### 3.2 수익 차트 (중앙)
- 누적 수익 그래프 (시간축)
- 옵션별 비교 라인 (손절 ON/OFF 등)
- 드로다운 히스토리

### 3.3 종목별 성과 테이블 (하단)
| 종목 | 거래횟수 | 승률 | 수익률 | 기여도 |
|------|----------|------|--------|--------|
| HOOD | 45 | 62% | +8.5% | 55.6% |
| AVGO | 32 | 55% | +4.2% | 27.5% |
| ... | ... | ... | ... | ... |

---

## 4. 비교 분석 기능

### 4.1 A/B 옵션 비교
- 두 가지 옵션 세트 동시 실행
- 결과 오버레이 차트로 비교
- 예: 손절 -2% vs 손절 -3%

### 4.2 프리셋 저장
- 자주 쓰는 옵션 조합 저장
- "보수적", "공격적" 등 프리셋 제공

### 4.3 추천 기능
- 선택 종목 기반 최적 옵션 추천
- 과거 데이터 기반 시뮬레이션

---

## 5. API 엔드포인트

### 5.1 통합 백테스트 실행
```
POST /api/backtest/integrated
{
  "tickers": ["HOOD", "AVGO", "MU"],
  "period": {
    "start": "2025-11-01",
    "end": "2025-12-01"
  },
  "options": {
    "initial_capital": 100000,
    "entry_threshold": 0.6,
    "stop_loss": { "enabled": true, "rate": -0.02 },
    "take_profit": { "enabled": true, "rate": 0.01 },
    "max_hold_hours": 1,
    "max_drawdown": 0.2,
    "position_sizing": "fixed",
    "market_hours_only": true,
    "max_concurrent_positions": 5
  }
}
```

### 5.2 응답
```
{
  "summary": {
    "total_return": 0.153,
    "total_profit": 15300,
    "win_rate": 0.582,
    "max_drawdown": -0.085,
    "sharpe_ratio": 1.42,
    "total_trades": 128
  },
  "equity_curve": [...],
  "by_ticker": {...},
  "trades": [...]
}
```

---

## 6. 구현 우선순위

### Phase 1 (필수)
1. 다중 종목 선택 UI
2. 손절/익절 토글 옵션
3. 기본 결과 차트 및 테이블

### Phase 2 (권장)
1. A/B 비교 기능
2. 프리셋 저장/불러오기
3. 수익 차트 오버레이

### Phase 3 (선택)
1. AI 기반 옵션 추천
2. PDF 리포트 내보내기
3. 알림 설정

---

## 7. 기술 스택

| 영역 | 기술 |
|------|------|
| 프론트엔드 | React + TailwindCSS |
| 차트 라이브러리 | Recharts (기존 사용) |
| API 서버 | FastAPI (기존 확장) |
| 백테스트 엔진 | 기존 simulator.py 확장 |

---

## 8. 예상 일정

- Phase 1: 기본 기능 구현
- Phase 2: 비교/분석 기능 추가
- Phase 3: 고급 기능 추가

---

## 9. 참고 사항

### 기존 코드 활용
- `src/backtester/simulator.py`: 백테스트 로직 확장
- `src/frontend/`: 새 페이지 추가 (IntegratedBacktest.jsx)
- `src/api/routes/`: 새 엔드포인트 추가

### 주의사항
- 다중 종목 동시 백테스트 시 성능 고려
- 큰 기간/많은 종목 선택 시 비동기 처리 권장
- WebSocket으로 진행률 표시 고려

---

**작성**: 분석팀장
**작성일**: 2025-12-26
**버전**: 1.0
