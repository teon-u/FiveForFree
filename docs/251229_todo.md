# FiveForFree í•™ìŠµ ë¡œì§ ê°œì„  TODO

> ìž‘ì„±ì¼: 2024-12-29
> ëª©ì : í•™ìŠµ ê´€ë ¨ ì½”ë“œ êµ¬ì¡°í™” ë¶„ì„ ë° ê°œì„ 

---

## ðŸ“‹ ëª©ì°¨

1. [í˜„ìž¬ Target ì„¤ì •](#1-í˜„ìž¬-target-ì„¤ì •)
2. [í•™ìŠµ ì•„í‚¤í…ì²˜ êµ¬ì¡°](#2-í•™ìŠµ-ì•„í‚¤í…ì²˜-êµ¬ì¡°)
3. [ë°œê²¬ëœ ë¬¸ì œì ](#3-ë°œê²¬ëœ-ë¬¸ì œì )
4. [ê°œì„  ìž‘ì—… ëª©ë¡](#4-ê°œì„ -ìž‘ì—…-ëª©ë¡)
5. [ìž‘ì—… ì§„í–‰ ìƒí™©](#5-ìž‘ì—…-ì§„í–‰-ìƒí™©)

---

## 1. í˜„ìž¬ Target ì„¤ì •

### 1.1 ì„¤ì •ê°’ (config/settings.py)

| ì„¤ì • | ê°’ | ì„¤ëª… |
|------|-----|------|
| `TARGET_PERCENT` | 0.5 | ëª©í‘œ ìˆ˜ìµë¥  (Â±0.5%) |
| `PREDICTION_HORIZON_MINUTES` | 60 | ì˜ˆì¸¡ ì‹œê°„ ë²”ìœ„ (60ë¶„) |
| `PROBABILITY_THRESHOLD` | 0.60 | ì‹ í˜¸ ë°œìƒ ìµœì†Œ í™•ë¥  |
| `USE_HYBRID_ENSEMBLE` | True | í•˜ì´ë¸Œë¦¬ë“œ ì•™ìƒë¸” ì‚¬ìš© |
| `ENSEMBLE_ALPHA` | 0.5 | ì§ì ‘ ì˜ˆì¸¡ ê°€ì¤‘ì¹˜ (50%) |

### 1.2 Target ì¢…ë¥˜

#### Structure A: ì§ì ‘ ì˜ˆì¸¡ (Primary)
```
PREDICTION_TARGETS = ["up", "down"]
```

| Target | ë ˆì´ë¸” ì¡°ê±´ | ì˜ë¯¸ |
|--------|------------|------|
| `up` | 60ë¶„ ë‚´ +0.5% ë„ë‹¬ | ìƒìŠ¹ ì˜ˆì¸¡ |
| `down` | 60ë¶„ ë‚´ -0.5% ë„ë‹¬ | í•˜ë½ ì˜ˆì¸¡ |

**ë ˆì´ë¸” ìƒì„± ë¡œì§ (label_generator.py:126-127):**
```python
label_up = 1 if max_gain >= self.target_percent else 0
label_down = 1 if max_loss <= -self.target_percent else 0
```

#### Structure B: í•˜ì´ë¸Œë¦¬ë“œ ì˜ˆì¸¡ (Secondary)
```
HYBRID_TARGETS = ["volatility", "direction"]
```

| Target | ë ˆì´ë¸” ì¡°ê±´ | ì˜ë¯¸ |
|--------|------------|------|
| `volatility` | Â±0.5% ë„ë‹¬ ì—¬ë¶€ | ë³€ë™ì„± ë°œìƒ ì˜ˆì¸¡ |
| `direction` | ìƒìŠ¹/í•˜ë½ ë°©í–¥ | ë°©í–¥ ì˜ˆì¸¡ (volatility=1ì¼ ë•Œë§Œ ìœ íš¨) |

**ë ˆì´ë¸” ìƒì„± ë¡œì§ (label_generator.py:150-170):**
```python
# ë³€ë™ì„±: up ë˜ëŠ” down ì¤‘ í•˜ë‚˜ë¼ë„ ë„ë‹¬
label_volatility = 1 if (label_up == 1 or label_down == 1) else 0

# ë°©í–¥: ì–´ëŠ ìª½ì´ ë¨¼ì € ë„ë‹¬í–ˆëŠ”ì§€
if label_volatility == 1:
    if minutes_to_target_up <= minutes_to_target_down:
        label_direction = 1  # ìƒìŠ¹ì´ ë¨¼ì €
    else:
        label_direction = 0  # í•˜ë½ì´ ë¨¼ì €
```

### 1.3 ìµœì¢… ì˜ˆì¸¡ ê²°í•©

```python
# realtime_predictor.py:320-321
final_up_prob = alpha * direct_up_prob + (1 - alpha) * hybrid_up_prob
final_down_prob = alpha * direct_down_prob + (1 - alpha) * hybrid_down_prob
```

**í˜„ìž¬ ê°€ì¤‘ì¹˜ (alpha=0.5):**
- ì§ì ‘ ì˜ˆì¸¡ (Structure A): 50%
- í•˜ì´ë¸Œë¦¬ë“œ ì˜ˆì¸¡ (Structure B): 50%

### 1.4 ëª¨ë¸ë³„ Target êµ¬ì¡°

```
Ticker (ì˜ˆ: AAPL)
â”œâ”€â”€ Structure A ëª¨ë¸ (10ê°œ)
â”‚   â”œâ”€â”€ up/
â”‚   â”‚   â”œâ”€â”€ xgboost_up.pkl
â”‚   â”‚   â”œâ”€â”€ lightgbm_up.pkl
â”‚   â”‚   â”œâ”€â”€ lstm_up.pkl + .pt + .scaler
â”‚   â”‚   â”œâ”€â”€ transformer_up.pkl + .pt + .scaler
â”‚   â”‚   â””â”€â”€ ensemble_up.pkl
â”‚   â””â”€â”€ down/
â”‚       â”œâ”€â”€ xgboost_down.pkl
â”‚       â”œâ”€â”€ lightgbm_down.pkl
â”‚       â”œâ”€â”€ lstm_down.pkl + .pt + .scaler
â”‚       â”œâ”€â”€ transformer_down.pkl + .pt + .scaler
â”‚       â””â”€â”€ ensemble_down.pkl
â”‚
â””â”€â”€ Structure B ëª¨ë¸ (USE_HYBRID_ENSEMBLE=Trueì¼ ë•Œ, 10ê°œ ì¶”ê°€)
    â”œâ”€â”€ volatility/
    â”‚   â”œâ”€â”€ xgboost_volatility.pkl
    â”‚   â”œâ”€â”€ ...
    â””â”€â”€ direction/
        â”œâ”€â”€ xgboost_direction.pkl
        â”œâ”€â”€ ...
```

---

## 2. í•™ìŠµ ì•„í‚¤í…ì²˜ êµ¬ì¡°

### 2.1 í•™ìŠµ íŒŒì´í”„ë¼ì¸

```
[ë°ì´í„° ìˆ˜ì§‘]
    â”‚
    â–¼
MinuteBar (DB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â–¼
[í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§] FeatureEngineer.compute_features()
    â”‚  - ê°€ê²© í”¼ì²˜ (15): SMA, RSI, MACD ë“±
    â”‚  - ë³€ë™ì„± í”¼ì²˜ (10): ATR, Bollinger Bands
    â”‚  - ê±°ëž˜ëŸ‰ í”¼ì²˜ (8): OBV, MFI
    â”‚  - ëª¨ë©˜í…€ í”¼ì²˜ (8): ROC
    â”‚  - ì‹œìž¥ ì»¨í…ìŠ¤íŠ¸ (5)
    â”‚  - ì‹œê°„ í”¼ì²˜ (3)
    â”‚  Total: 49 features
    â–¼
[ë ˆì´ë¸” ìƒì„±] LabelGenerator.generate_labels()
    â”‚  - label_up, label_down (Structure A)
    â”‚  - label_volatility, label_direction (Structure B)
    â–¼
[Train/Val Split] 80/20 ì‹œê³„ì—´ ìˆœì„œ ìœ ì§€
    â”‚
    â–¼
[ëª¨ë¸ í•™ìŠµ] GPUParallelTrainer
    â”œâ”€â”€ Tree Models (Parallel): XGBoost, LightGBM
    â”œâ”€â”€ Neural Models (Sequential): LSTM, Transformer
    â””â”€â”€ Ensemble (After Base): Meta-learner
    â”‚
    â–¼
[ëª¨ë¸ ì €ìž¥] ModelManager.save_models()
    â”‚  - .pkl (ëª¨ë¸ ë©”íƒ€ë°ì´í„°)
    â”‚  - .pt (PyTorch ê°€ì¤‘ì¹˜)
    â”‚  - .scaler (ì •ê·œí™” ìŠ¤ì¼€ì¼ëŸ¬)
    â”‚  - .json (XGBoost booster)
```

### 2.2 ê° ëª¨ë¸ì˜ íŠ¹ì„±

| ëª¨ë¸ | ìž…ë ¥ í˜•íƒœ | GPU ì§€ì› | ì €ìž¥ íŒŒì¼ |
|------|----------|----------|----------|
| XGBoost | (n_samples, 49) | âœ… | .pkl, .json |
| LightGBM | (n_samples, 49) | âœ… | .pkl |
| LSTM | (n_samples, 60, 49) | âœ… | .pkl, .pt, .scaler |
| Transformer | (n_samples, 60, 49) | âœ… | .pkl, .pt, .scaler |
| Ensemble | base model predictions | âŒ | .pkl |

---

## 3. ë°œê²¬ëœ ë¬¸ì œì 

### ðŸ”´ Critical (ìš°ì„  í•´ê²°)

#### ë¬¸ì œ 1: í•™ìŠµ ë¯¸ì™„ë£Œ ìƒíƒœì—ì„œ 0% í‘œì‹œ
- **ìœ„ì¹˜**: `base_model.py:201-250`
- **ì¦ìƒ**: ëŒ€ì‹œë³´ë“œì—ì„œ hit_rateê°€ 0%ë¡œ í‘œì‹œ
- **ì›ì¸**:
  - `prediction_history`ê°€ ë¹„ì–´ìžˆìœ¼ë©´ `train_accuracy` ë°˜í™˜
  - `train_accuracy`ê°€ 0.0ì´ë©´ 0% í‘œì‹œ
  - ëª¨ë¸ì€ `is_trained=True`ì¸ë° ì •í™•ë„ ë°ì´í„° ì—†ìŒ

#### ë¬¸ì œ 2: LSTM/Transformer .pt íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨
- **ìœ„ì¹˜**: `model_manager.py:95-100`
- **ì¦ìƒ**: ì˜ˆì¸¡ ì‹œ "Model not trained" ì—ëŸ¬
- **ì›ì¸**:
  - .pt íŒŒì¼ì´ ì—†ê±°ë‚˜ ì†ìƒë˜ë©´ `_model=None`
  - ë¡œë“œ ì‹¤íŒ¨í•´ë„ `is_trained=True` ìœ ì§€
  - `predict_proba()` í˜¸ì¶œ ì‹œ ì—ëŸ¬ ë°œìƒ

#### ë¬¸ì œ 3: ì•™ìƒë¸” ê· ë“± ê°€ì¤‘ì¹˜ (25%ì”©)
- **ìœ„ì¹˜**: `ensemble_model.py:136-159`
- **ì¦ìƒ**: ì„±ëŠ¥ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ëª¨ë¸ 25% ê°€ì¤‘ì¹˜
- **ì›ì¸**:
  - ì´ˆê¸°ì—ëŠ” `prediction_history` ì—†ì–´ì„œ precision=0
  - precisionì´ BREAKEVEN(0.30) ì´í•˜ë©´ ê· ë“± ë¶„ë°°
  - `train_accuracy` fallbackì´ ì œëŒ€ë¡œ ìž‘ë™ ì•ˆí•¨

### ðŸŸ¡ Important

#### ë¬¸ì œ 4: best_model ì„ íƒ ê¸°ì¤€ í—ˆì 
- **ìœ„ì¹˜**: `model_manager.py:258-296`
- **ì›ì¸**: `hit_rate=0.0`ì¸ ëª¨ë¸ë„ bestë¡œ ì„ íƒ ê°€ëŠ¥

#### ë¬¸ì œ 5: í•™ìŠµ ì™„ë£Œ íŒì • ê¸°ì¤€ ëª¨í˜¸
- **ìœ„ì¹˜**: `lstm_model.py:247-248`
- **ì›ì¸**: í•™ìŠµ ë£¨í”„ë§Œ ì™„ë£Œë˜ë©´ `is_trained=True`

#### ë¬¸ì œ 6: ì•™ìƒë¸” model_manager ì°¸ì¡° ëˆ„ë½
- **ìœ„ì¹˜**: `ensemble_model.py:464-477`
- **ì›ì¸**: pickle í›„ ë¡œë“œ ì‹œ `set_model_manager()` í˜¸ì¶œ í•„ìš”

---

## 4. ê°œì„  ìž‘ì—… ëª©ë¡

### Phase 0: ë°ì´í„° ìˆ˜ì§‘ êµ¬ì¡° ì ê²€ (ì‹ ê·œ)

- [ ] **Task 0.1**: 50ì‹œê°„ prediction_history ìˆ˜ì§‘ êµ¬ì¡° ì ê²€
  - prediction_historyê°€ ì–´ë–»ê²Œ ìŒ“ì´ëŠ”ì§€ í™•ì¸
  - ì‹¤ì‹œê°„ ì˜ˆì¸¡ â†’ outcome ì—…ë°ì´íŠ¸ íë¦„ ê²€ì¦
  - ì„œë²„ ìž¬ì‹œìž‘ ì‹œ ë°ì´í„° ìœ ì§€ ì—¬ë¶€ í™•ì¸

- [ ] **Task 0.2**: outcome ì—…ë°ì´íŠ¸ ë¡œì§ ì ê²€
  - ì˜ˆì¸¡ í›„ 60ë¶„ ë’¤ ì‹¤ì œ ê²°ê³¼ ë°˜ì˜ ë¡œì§
  - ëˆ„ë½ë˜ëŠ” ì¼€ì´ìŠ¤ í™•ì¸

### Phase 1: í•™ìŠµ ìƒíƒœ ëª…í™•í™” (Option D ì ìš©)

- [ ] **Task 1.1**: Validation Precision ì €ìž¥ (Option D-1)
  - í•™ìŠµ ì‹œ validation setìœ¼ë¡œ `initial_precision`, `initial_recall` ê³„ì‚°
  - base_model.pyì— ì†ì„± ì¶”ê°€
  - ê° ëª¨ë¸ì˜ train() ë©”ì„œë“œ ìˆ˜ì •

- [ ] **Task 1.2**: hit_rate í‘œì‹œ ìš°ì„ ìˆœìœ„ ë¡œì§ (Option D-2)
  - 1ìˆœìœ„: ìµœê·¼ 50ì‹œê°„ prediction_historyì˜ precision
  - 2ìˆœìœ„: DB ìºì‹œëœ precision
  - 3ìˆœìœ„: initial_precision (validation ê¸°ë°˜)
  - 4ìˆœìœ„: train_accuracy (ìµœí›„ fallback)
  - model_manager.pyì˜ get_model_performances() ìˆ˜ì •

- [ ] **Task 1.3**: ë°ì´í„° ì†ŒìŠ¤ í‘œì‹œ (Option D-3)
  - API ì‘ë‹µì— `source` í•„ë“œ ì¶”ê°€
  - "realtime" | "db" | "validation" | "training" êµ¬ë¶„
  - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì†ŒìŠ¤ í‘œì‹œ (ì„ íƒì )

- [ ] **Task 1.4**: LSTM/Transformer ë¡œë“œ ì‹¤íŒ¨ ì²˜ë¦¬
  - .pt íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨ ì‹œ `is_trained=False` ì„¤ì •
  - ë¡œë“œ ìƒíƒœ ë¡œê¹… ê°œì„ 

### Phase 2: ì•™ìƒë¸” ê°€ì¤‘ì¹˜ ê°œì„ 

- [ ] **Task 2.1**: ì´ˆê¸° ê°€ì¤‘ì¹˜ ê³„ì‚° ê°œì„ 
  - `train_accuracy` ê¸°ë°˜ ì´ˆê¸° ê°€ì¤‘ì¹˜ ì‚¬ìš©
  - precision ë°ì´í„° ì—†ì„ ë•Œ ëŒ€ì•ˆ ì œê³µ

- [ ] **Task 2.2**: ë™ì  ê°€ì¤‘ì¹˜ ì¡°ì •
  - prediction_history ê¸°ë°˜ ì‹¤ì‹œê°„ ì¡°ì •
  - ì„±ëŠ¥ ë‚®ì€ ëª¨ë¸ ê°€ì¤‘ì¹˜ í•˜í–¥

### Phase 3: ëª¨ë¸ ì„ íƒ ê°•í™”

- [ ] **Task 3.1**: best_model ìµœì†Œ ê¸°ì¤€ ì¶”ê°€
  - ìµœì†Œ hit_rate ìž„ê³„ê°’ ì„¤ì •
  - í•™ìŠµ í’ˆì§ˆ ê²€ì¦ í†µê³¼ í•„ìˆ˜

- [ ] **Task 3.2**: ëª¨ë¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§
  - ëŒ€ì‹œë³´ë“œì— í•™ìŠµ ìƒíƒœ í‘œì‹œ
  - "í•™ìŠµì¤‘", "í•™ìŠµì™„ë£Œ", "í•™ìŠµì‹¤íŒ¨" êµ¬ë¶„

---

## 5. ìž‘ì—… ì§„í–‰ ìƒí™©

| Task | ìƒíƒœ | ë‹´ë‹¹ | ì™„ë£Œì¼ |
|------|------|------|--------|
| ë¬¸ì„œ ìž‘ì„± | âœ… ì™„ë£Œ | Claude | 2024-12-29 |
| Target ì„¤ì • ë¶„ì„ | âœ… ì™„ë£Œ | Claude | 2024-12-29 |
| Task 1.1 | â³ ëŒ€ê¸° | - | - |
| Task 1.2 | â³ ëŒ€ê¸° | - | - |
| Task 1.3 | â³ ëŒ€ê¸° | - | - |
| Task 2.1 | â³ ëŒ€ê¸° | - | - |
| Task 2.2 | â³ ëŒ€ê¸° | - | - |
| Task 3.1 | â³ ëŒ€ê¸° | - | - |
| Task 3.2 | â³ ëŒ€ê¸° | - | - |

---

## ë¶€ë¡: í•µì‹¬ ì½”ë“œ ìœ„ì¹˜

| ê¸°ëŠ¥ | íŒŒì¼ | ë¼ì¸ |
|------|------|------|
| í•™ìŠµ íŠ¸ë ˆì´ë„ˆ | `src/trainer/gpu_trainer.py` | ì „ì²´ |
| ëª¨ë¸ ë§¤ë‹ˆì € | `src/models/model_manager.py` | ì „ì²´ |
| ì•™ìƒë¸” ëª¨ë¸ | `src/models/ensemble_model.py` | ì „ì²´ |
| LSTM ëª¨ë¸ | `src/models/lstm_model.py` | ì „ì²´ |
| Transformer ëª¨ë¸ | `src/models/transformer_model.py` | ì „ì²´ |
| ë² ì´ìŠ¤ ëª¨ë¸ | `src/models/base_model.py` | ì „ì²´ |
| ë ˆì´ë¸” ìƒì„± | `src/processor/label_generator.py` | ì „ì²´ |
| ì„¤ì • | `config/settings.py` | ì „ì²´ |
| ì‹¤ì‹œê°„ ì˜ˆì¸¡ | `src/predictor/realtime_predictor.py` | ì „ì²´ |
| API ë¼ìš°íŠ¸ | `src/api/routes/models.py` | ì „ì²´ |
